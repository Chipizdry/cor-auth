


<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <title>–°–±—Ä–æ—Å –ø–∞—Ä–æ–ª—è</title>
  <!--  <link rel="stylesheet" type="text/css" href="styles.css">  -->
<style>
    /* –û—Å–Ω–æ–≤–Ω—ã–µ —Å—Ç–∏–ª–∏ */
    body {
        font-family: Arial, sans-serif;
    }
    
    .container {
        max-width: 600px;
        margin: 0 auto;
        padding: 20px;
        border: 1px solid #ccc;
        border-radius: 10px;
        box-shadow: 0 0 10px rgba(0, 0, 0, 0.1);
    }
    
    h1 {
        text-align: center;
    }
    
    /* –°—Ç–∏–ª–∏ –¥–ª—è —Ñ–æ—Ä–º—ã */
    form {
        display: flex;
        flex-direction: column;
    }
    
    label {
        margin: 10px 0 5px;
    }
    
    .input-wrapper {
        position: relative;
        
    }
    
    input[type="email"],
    input[type="password"],
    input[type="text"] {
        padding: 10px;
        margin-bottom: 10px;
        border: 1px solid #ccc;
        border-radius: 5px;
        width: 100%;
    }
    
    input[type="button"],
    input[type="submit"],
    button {
        padding: 10px;
        margin: 10px 0;
        border: none;
        border-radius: 5px;
        background-color: #007BFF;
        color: white;
        cursor: pointer;
    }
    
    input[type="button"]:hover,
    input[type="submit"]:hover,
    button:hover {
        background-color: #0056b3;
    }
    
    /* –°—Ç–∏–ª–∏ –¥–ª—è —Å–æ–æ–±—â–µ–Ω–∏–π */
    .message,
    .messageOk {
        padding: 10px;
        margin: 10px 0;
        border-radius: 5px;
    }
    
    .messageOk {
        background-color: #d4edda;
        color: #155724;
    }
    
    .hidden {
        display: none;
    }
    
    /* –°—Ç–∏–ª–∏ –¥–ª—è –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä–∞ –ø–∞—Ä–æ–ª–µ–π */
    .password-container {
        display: flex;
        flex-direction: column;
    }
    
    .toggle-password {
        position: absolute;
    right: 10px;
    top: 50%;
    transform: translateY(-50%);
    cursor: pointer;
    font-size: 18px;
    user-select: none;
    }
</style>
</head>
<body>
    <div class="container">
        <h1>–°–±—Ä–æ—Å –ø–∞—Ä–æ–ª—è</h1>
        <form id="forgotPasswordForm">
            <label for="email">–≠–ª–µ–∫—Ç—Ä–æ–Ω–Ω–∞—è –ø–æ—á—Ç–∞:</label>
            <input type="email" id="email" name="email" required>
            <br>
            <input type="button" id="sendCodeOnMail" value="–û—Ç–ø—Ä–∞–≤–∏—Ç—å –∫–æ–¥ –Ω–∞ –∏–º–µ–π–ª" onclick="sendVerificationCode()">
            <br>
            <div id="message" class="message"></div>

            <div id="verificationCodeWindow" style="display: none;">
                <input type="text" id="verificationCodeInput">
                <input type="button" id="sendVerifCode" value="–ü–æ–¥—Ç–≤–µ—Ä–¥–∏—Ç—å" onclick="verifyVerificationCode()">
            </div>

            <br>

            <div class="password-container" style="display: none;">
                <label for="password">–ü–∞—Ä–æ–ª—å:</label>
                <div class="input-wrapper">
                <input type="password" id="password" placeholder="–í–≤–µ–¥–∏—Ç–µ –ø–∞—Ä–æ–ª—å" name="password" minlength="4" maxlength="10" required>
                <span class="toggle-password" data-target="#password">üëÅÔ∏è</span>
                </div>
            </div>

            <br>

            <div class="password-container" style="display: none;">
                <label for="confirm-password">–ü–æ–≤—Ç–æ—Ä–∏—Ç–µ –ø–∞—Ä–æ–ª—å:</label>
                <div class="input-wrapper"></div>
                <input type="password" id="confirm-password" placeholder="–ü–æ–¥—Ç–≤–µ—Ä–¥–∏—Ç–µ –ø–∞—Ä–æ–ª—å" minlength="4" maxlength="10" required>
                <span class="toggle-password" data-target="#confirm-password">üëÅÔ∏è</span>
                </div>
            </div>

            <br>

            <input type="button" value="–ü–æ–¥—Ç–≤–µ—Ä–¥–∏—Ç—å –∏–∑–º–µ–Ω–µ–Ω–∏—è" id="confirm-button">
            <button type="button" id="login-button" class="hidden">–í–û–ô–¢–ò</button>

            <br>
            <div id="messageOk" class="messageOk"></div>
        </form>
        <br>
    </div>

    <script>
        document.addEventListener('DOMContentLoaded', function() {
            const passwordInput = document.getElementById('password');
            const confirmPasswordInput = document.getElementById('confirm-password');
            const form = document.getElementById('forgotPasswordForm');
            const messageDiv = document.getElementById('messageOk');
            const confirmButton = document.getElementById('confirm-button');
            const loginButton = document.getElementById('login-button');

            confirmButton.addEventListener('click', (event) => {
                event.preventDefault();

                if (passwordInput.value !== confirmPasswordInput.value) {
                    alert('–ü–∞—Ä–æ–ª–∏ –Ω–µ —Å–æ–≤–ø–∞–¥–∞—é—Ç!');
                } else {
                    alert('–ü–∞—Ä–æ–ª–∏ —Å–æ–≤–ø–∞–¥–∞—é—Ç');
                    const formData = new FormData(form);
                    const formDataJson = {};

                    formData.forEach((value, key) => {
                        formDataJson[key] = value;
                    });

                    const xhr = new XMLHttpRequest();
                    xhr.open("PATCH", "/api/auth/change-password"); // –£–±–µ–¥–∏—Ç–µ—Å—å, —á—Ç–æ –≤–∞—à URL –ø—Ä–∞–≤–∏–ª—å–Ω—ã–π
                    xhr.setRequestHeader("Content-Type", "application/json");

                    xhr.onreadystatechange = function() {
                        if (xhr.readyState === XMLHttpRequest.DONE) {
                            if (xhr.status === 200) {
                                const response = JSON.parse(xhr.responseText);
                                console.log("–í–∞—à –ø–∞—Ä–æ–ª—å –æ–±–Ω–æ–≤–ª—ë–Ω.");
                                messageDiv.innerText = response.detail || "–ü–∞—Ä–æ–ª—å –∏–∑–º–µ–Ω—ë–Ω.";
                                messageDiv.style.color = 'green';
                                confirmButton.style.display = 'none'; 
                                loginButton.style.display = 'block';
                            } else {
                                console.error("–ü—Ä–æ–∏–∑–æ—à–ª–∞ –æ—à–∏–±–∫–∞ –ø—Ä–∏ –∏–∑–º–µ–Ω–µ–Ω–∏–∏ –ø–∞—Ä–æ–ª—è.");
                                messageDiv.innerText = "–û—à–∏–±–∫–∞ –ø—Ä–∏ –∏–∑–º–µ–Ω–µ–Ω–∏–∏ –ø–∞—Ä–æ–ª—è.";
                                messageDiv.style.color = 'red';
                            }
                        }
                    };

                    xhr.send(JSON.stringify(formDataJson));
                }
            });

            loginButton.addEventListener('click', () => {
                const email = document.getElementById('email').value;
                const password = document.getElementById('password').value;

                const loginDataParams = new URLSearchParams();
                loginDataParams.append('username', email); // –û–±—Ä–∞—Ç–∏—Ç–µ –≤–Ω–∏–º–∞–Ω–∏–µ –Ω–∞ 'username'
                loginDataParams.append('password', password);

                const xhr = new XMLHttpRequest();
                xhr.open("POST", "/api/auth/login");
                xhr.setRequestHeader("Content-Type", "application/x-www-form-urlencoded");

                xhr.onreadystatechange = function() {
                    if (xhr.readyState === XMLHttpRequest.DONE) {
                        if (xhr.status === 200) {
                            const response = JSON.parse(xhr.responseText);
                            console.log("–í—Ö–æ–¥ –≤—ã–ø–æ–ª–Ω–µ–Ω —É—Å–ø–µ—à–Ω–æ!");
                            messageDiv.innerText = "–í—Ö–æ–¥ –≤—ã–ø–æ–ª–Ω–µ–Ω —É—Å–ø–µ—à–Ω–æ!";
                            messageDiv.style.color = 'green';

                            // –î–æ–±–∞–≤–ª–µ–Ω–∏–µ —Ä–µ–¥–∏—Ä–µ–∫—Ç–∞ —á–µ—Ä–µ–∑ 1 —Å–µ–∫—É–Ω–¥—É –ø–æ—Å–ª–µ —É—Å–ø–µ—à–Ω–æ–≥–æ –≤—Ö–æ–¥–∞
                            setTimeout(() => {
                                window.location.href = "https://cor-platform.azurewebsites.net/?access_token=" + response.access_token;
                            }, 500);

                        } else {
                            console.error("–ü—Ä–æ–∏–∑–æ—à–ª–∞ –æ—à–∏–±–∫–∞ –ø—Ä–∏ –≤—Ö–æ–¥–µ.");
                            messageDiv.innerText = "–û—à–∏–±–∫–∞ –≤—Ö–æ–¥–∞.";
                            messageDiv.style.color = 'red';
                        }
                    }
                };

                xhr.send(loginDataParams.toString());
            });
        });
    </script>


         
        <script>
           

            function sendVerificationCode() {
                var form = document.getElementById("forgotPasswordForm");
                var emailInput = form.elements.email;
                var messageDiv = document.getElementById("message");
                var email = emailInput.value;
              
                var xhr = new XMLHttpRequest();
                xhr.open("POST", "/api/auth/forgot password");
                xhr.setRequestHeader("Content-Type", "application/json");


                

                xhr.onreadystatechange = function() {
                if (xhr.readyState === XMLHttpRequest.DONE) {
                    if (xhr.status === 200) {
                    
                    // –û–±—Ä–∞–±–æ—Ç–∫–∞ —É—Å–ø–µ—à–Ω–æ–≥–æ –æ—Ç–≤–µ—Ç–∞ –æ—Ç —Å–µ—Ä–≤–µ—Ä–∞
                    alert('–ö–æ–¥-–ø–∞—Ä–æ–ª—å –¥–ª—è –≤–æ—Å—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω–∏—è –≤—ã—Å–ª–∞–Ω –í–∞–º –Ω–∞ –∏–º–µ–π–ª!');
                    console.log("–ö–æ–¥ –ø–æ–¥—Ç–≤–µ—Ä–∂–¥–µ–Ω–∏—è –æ—Ç–ø—Ä–∞–≤–ª–µ–Ω –Ω–∞ –≤–∞—à—É —ç–ª–µ–∫—Ç—Ä–æ–Ω–Ω—É—é –ø–æ—á—Ç—É.");
                    document.getElementById('message').style.display = 'none'; 
                    showVerificationCodeInput(); // –ü–æ–∫–∞–∑–∞—Ç—å –æ–±–ª–∞—Å—Ç—å –¥–ª—è –≤–≤–æ–¥–∞ –∫–æ–¥–∞
                    } else {         // –û–±—Ä–∞–±–æ—Ç–∫–∞ –æ—à–∏–±–∫–∏
                        var error = JSON.parse(xhr.responseText);
                        console.error("–ü—Ä–æ–∏–∑–æ—à–ª–∞ –æ—à–∏–±–∫–∞ –ø—Ä–∏ –æ—Ç–ø—Ä–∞–≤–∫–µ –∫–æ–¥–∞ –ø–æ–¥—Ç–≤–µ—Ä–∂–¥–µ–Ω–∏—è –Ω–∞ –ø–æ—á—Ç—É.");
                        messageDiv.innerText = error.detail || "–ü—Ä–æ–∏–∑–æ—à–ª–∞ –æ—à–∏–±–∫–∞ –ø—Ä–∏ –æ—Ç–ø—Ä–∞–≤–∫–µ –∫–æ–¥–∞ –ø–æ–¥—Ç–≤–µ—Ä–∂–¥–µ–Ω–∏—è –Ω–∞ –ø–æ—á—Ç—É.";
                        messageDiv.style.color = 'red';

                   
                        }
                    }
                };

                xhr.send(JSON.stringify({ email: email }));
            }

            function showVerificationCodeInput() {
                var verificationCodeWindow = document.getElementById("verificationCodeWindow");
                verificationCodeWindow.style.display = "block";
            }

            function verifyVerificationCode() {
                var verificationCodeInput = document.getElementById("verificationCodeInput");
                var emailInput = document.getElementById("email");
                
                var form = document.getElementById("forgotPasswordForm");

                var email = emailInput.value;
                var verificationCode = verificationCodeInput.value;

                var xhr = new XMLHttpRequest();
                xhr.open("POST", "/api/auth/confirm_email");
                xhr.setRequestHeader("Content-Type", "application/json");

                xhr.onreadystatechange = function() {
                    if (xhr.readyState === XMLHttpRequest.DONE) {
                        if (xhr.status === 200) {
                            // –û–±—Ä–∞–±–æ—Ç–∫–∞ —É—Å–ø–µ—à–Ω–æ–≥–æ –æ—Ç–≤–µ—Ç–∞ –æ—Ç —Å–µ—Ä–≤–µ—Ä–∞

                            const containers = document.querySelectorAll('.password-container');
                                containers.forEach(container => {  container.style.display = 'block';});
                                document.getElementById('sendVerifCode').style.display = 'none';
                                document.getElementById('verificationCodeInput').style.display = 'none';  
                                document.getElementById('sendCodeOnMail').style.display = 'none';  
                              //  document.getElementById('email').style.display = 'none';  
                               
                               // form.style.display = 'none'; 

                            alert('–ö–æ–¥ –ø–æ–¥—Ç–≤–µ—Ä–∂–¥–µ–Ω–∏—è –≤–µ—Ä–Ω—ã–π!');
                            console.log("–ö–æ–¥ –ø–æ–¥—Ç–≤–µ—Ä–∂–¥–µ–Ω–∏—è –≤–µ—Ä–Ω—ã–π.");
                            


                        } else {
                            // –û–±—Ä–∞–±–æ—Ç–∫–∞ –æ—à–∏–±–∫–∏
                            alert('–ù–µ–≤–µ—Ä–Ω—ã–π –∫–æ–¥ –ø–æ–¥—Ç–≤–µ—Ä–∂–¥–µ–Ω–∏—è!!!!!!');
                            console.error("–ù–µ–≤–µ—Ä–Ω—ã–π –∫–æ–¥ –ø–æ–¥—Ç–≤–µ—Ä–∂–¥–µ–Ω–∏—è.");
                        }
                    }
                };

                xhr.send(JSON.stringify({ email: email, verification_code: verificationCode }));
            }
        </script>



<script>
document.addEventListener('DOMContentLoaded', function() {
    document.querySelectorAll('.toggle-password').forEach(function(element) {
        element.addEventListener('click', function() {
            const targetInput = document.querySelector(this.dataset.target);
            if (targetInput.type === 'password') {
                targetInput.type = 'text';
                this.innerText = 'üôà'; // –ò–∑–º–µ–Ω–∏—Ç–µ –∏–∫–æ–Ω–∫—É –Ω–∞ "—Å–∫—Ä—ã—Ç—å"
            } else {
                targetInput.type = 'password';
                this.innerText = 'üëÅÔ∏è'; // –ò–∑–º–µ–Ω–∏—Ç–µ –∏–∫–æ–Ω–∫—É –Ω–∞ "–ø–æ–∫–∞–∑–∞—Ç—å"
            }
        });
    });
});
</script>  
</body>
</html>
