<!DOCTYPE html>
<html>
    <head>
        <title>–†–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏—è</title>
        <link rel="stylesheet" type="text/css" href="styles.css">

    
    </head>
    <body>
        <h1>–†–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏—è</h1>
            <form id="registrationForm">
                <label for="email">–≠–ª–µ–∫—Ç—Ä–æ–Ω–Ω–∞—è –ø–æ—á—Ç–∞:</label>
                <input type="email" id="email" name="email" required><br>
                
                   <br>
 
                    <div class="password-container" style="display: none;" >
                       <label for="password">–ü–∞—Ä–æ–ª—å: </label>    
                       <input type="password" id="password"  placeholder="–í–≤–µ–¥–∏—Ç–µ –ø–∞—Ä–æ–ª—å" name="password"  minlength="4" maxlength="10" required>
                       <span class="toggle-password" data-target="#password" required>üëÅÔ∏è</span>
                    </div>

                    <br>
                    
                <div class="password-container" style="display: none;">      
                    <label for="confirm-password">–ü–æ–≤—Ç–æ—Ä–∏—Ç–µ –ø–∞—Ä–æ–ª—å:</label>
                    <input type="password" id="confirm-password" placeholder="–ü–æ–¥—Ç–≤–µ—Ä–¥–∏—Ç–µ –ø–∞—Ä–æ–ª—å"  minlength="4" maxlength="10">
                    <span class="toggle-password" data-target="#confirm-password" required>üëÅÔ∏è</span>
                    <br>
                    <input type="submit" value="–ó–∞—Ä–µ–≥–∏—Å—Ç—Ä–∏—Ä–æ–≤–∞—Ç—å—Å—è">
                </div>


                   
                <br>
                <input type="button" id="sendVerifCode" value="–û—Ç–ø—Ä–∞–≤–∏—Ç—å –∫–æ–¥ –Ω–∞ –∏–º–µ–π–ª" onclick="sendVerificationCode()">
                <div id="message" class="message"></div>
             <br>
          
            <div id="verificationCodeWindow" style="display: none;">
                <input type="text" id="verificationCodeInput">
                <input type="button" id="ConfirmationCodeInput"  value="–ü–æ–¥—Ç–≤–µ—Ä–¥–∏—Ç—å" onclick="verifyVerificationCode()">
            </div>
        </form>
          
            <script>
                const togglePasswordIcons = document.querySelectorAll('.toggle-password');
        
                togglePasswordIcons.forEach(icon => {
                    icon.addEventListener('click', () => {
                        const target = document.querySelector(icon.getAttribute('data-target'));
                        const type = target.getAttribute('type') === 'password' ? 'text' : 'password';
                        target.setAttribute('type', type);
                    });
                });
            </script>




            <script>
                const passwordInput = document.getElementById('password');
                const confirmPasswordInput = document.getElementById('confirm-password');
                const form = document.querySelector('form');
            
                form.addEventListener('submit', (event) => {
                  event.preventDefault();
            
                  if (passwordInput.value !== confirmPasswordInput.value) {
                    alert('–ü–∞—Ä–æ–ª–∏ –Ω–µ —Å–æ–≤–ø–∞–¥–∞—é—Ç!');
                  } else {
                    alert('–ü–∞—Ä–æ–ª–∏ —Å–æ–≤–ø–∞–¥–∞—é—Ç');
                  }
                });
              </script>
               













        <script>
            document.getElementById("registrationForm").addEventListener("submit", function(event) {
                event.preventDefault();

                var form = event.target;
                var formData = new FormData(form);
                var formDataJson = {};

                formData.forEach(function(value, key) {
                formDataJson[key] = value;
                });

                var xhr = new XMLHttpRequest();
                xhr.open("POST", "/api/auth/signup");
                xhr.setRequestHeader("Content-Type", "application/json");

                xhr.onreadystatechange = function() {
                if (xhr.readyState === XMLHttpRequest.DONE) {
                    if (xhr.status === 200) {
                    // –û–±—Ä–∞–±–æ—Ç–∫–∞ —É—Å–ø–µ—à–Ω–æ–≥–æ –æ—Ç–≤–µ—Ç–∞ –æ—Ç —Å–µ—Ä–≤–µ—Ä–∞
                    console.log("–†–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏—è –ø—Ä–æ—à–ª–∞ —É—Å–ø–µ—à–Ω–æ!");
                    } else {
                    // –û–±—Ä–∞–±–æ—Ç–∫–∞ –æ—à–∏–±–∫–∏
                    console.error("–ü—Ä–æ–∏–∑–æ—à–ª–∞ –æ—à–∏–±–∫–∞ –ø—Ä–∏ —Ä–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏–∏.");
                    }
                }
                };

                xhr.send(JSON.stringify(formDataJson));
                // –†–µ–¥–∏—Ä–µ–∫—Ç –Ω–∞ –≥–ª–∞–≤–Ω—É—é —Å—Ç—Ä–∞–Ω–∏—Ü—É
                //window.location.href = "http://127.0.0.1:8000/";
            });

            function sendVerificationCode() {
                var form = document.getElementById("registrationForm");
                var emailInput = form.elements.email;
                var messageDiv = document.getElementById("message");
                var email = emailInput.value;

                var xhr = new XMLHttpRequest();
                xhr.open("POST", "/api/auth/send_verification_code");
                xhr.setRequestHeader("Content-Type", "application/json");

                xhr.onreadystatechange = function() {
                if (xhr.readyState === XMLHttpRequest.DONE) {
                    if (xhr.status === 200) {
                    // –û–±—Ä–∞–±–æ—Ç–∫–∞ —É—Å–ø–µ—à–Ω–æ–≥–æ –æ—Ç–≤–µ—Ç–∞ –æ—Ç —Å–µ—Ä–≤–µ—Ä–∞
                    alert('–ö–æ–¥ –ø–æ–¥—Ç–≤–µ—Ä–∂–¥–µ–Ω–∏—è –æ—Ç–ø—Ä–∞–≤–ª–µ–Ω –Ω–∞ –í–∞—à—É –ø–æ—á—Ç—É!');
                    console.log("–ö–æ–¥ –ø–æ–¥—Ç–≤–µ—Ä–∂–¥–µ–Ω–∏—è –æ—Ç–ø—Ä–∞–≤–ª–µ–Ω –Ω–∞ –≤–∞—à—É —ç–ª–µ–∫—Ç—Ä–æ–Ω–Ω—É—é –ø–æ—á—Ç—É.");
                    showVerificationCodeInput(); // –ü–æ–∫–∞–∑–∞—Ç—å –æ–±–ª–∞—Å—Ç—å –¥–ª—è –≤–≤–æ–¥–∞ –∫–æ–¥–∞
                    document.getElementById('message').style.display = 'none';  
                    } else {
                    // –û–±—Ä–∞–±–æ—Ç–∫–∞ –æ—à–∏–±–∫–∏
                               // –û–±—Ä–∞–±–æ—Ç–∫–∞ –æ—à–∏–±–∫–∏
                        var error = JSON.parse(xhr.responseText);
                        console.error("–ü—Ä–æ–∏–∑–æ—à–ª–∞ –æ—à–∏–±–∫–∞ –ø—Ä–∏ –æ—Ç–ø—Ä–∞–≤–∫–µ –∫–æ–¥–∞ –ø–æ–¥—Ç–≤–µ—Ä–∂–¥–µ–Ω–∏—è –Ω–∞ –ø–æ—á—Ç—É.");
                        messageDiv.innerText = error.detail || "–ü—Ä–æ–∏–∑–æ—à–ª–∞ –æ—à–∏–±–∫–∞ –ø—Ä–∏ –æ—Ç–ø—Ä–∞–≤–∫–µ –∫–æ–¥–∞ –ø–æ–¥—Ç–≤–µ—Ä–∂–¥–µ–Ω–∏—è –Ω–∞ –ø–æ—á—Ç—É.";
                        messageDiv.style.color = 'red';

                    console.error("–ü—Ä–æ–∏–∑–æ—à–ª–∞ –æ—à–∏–±–∫–∞ –ø—Ä–∏ –æ—Ç–ø—Ä–∞–≤–∫–µ –∫–æ–¥–∞ –ø–æ–¥—Ç–≤–µ—Ä–∂–¥–µ–Ω–∏—è –Ω–∞ –ø–æ—á—Ç—É.");
                        }
                    }
                };

                xhr.send(JSON.stringify({ email: email }));
            }

            function showVerificationCodeInput() {
                var verificationCodeWindow = document.getElementById("verificationCodeWindow");
                verificationCodeWindow.style.display = "block";
                
            }

            function verifyVerificationCode() {
                var verificationCodeInput = document.getElementById("verificationCodeInput");
                var emailInput = document.getElementById("email");

                var email = emailInput.value;
                var verificationCode = verificationCodeInput.value;

                var xhr = new XMLHttpRequest();
                xhr.open("POST", "/api/auth/confirm_email");
                xhr.setRequestHeader("Content-Type", "application/json");

                xhr.onreadystatechange = function() {
                    if (xhr.readyState === XMLHttpRequest.DONE) {
                        if (xhr.status === 200) {
                            // –û–±—Ä–∞–±–æ—Ç–∫–∞ —É—Å–ø–µ—à–Ω–æ–≥–æ –æ—Ç–≤–µ—Ç–∞ –æ—Ç —Å–µ—Ä–≤–µ—Ä–∞
                            console.log("–ö–æ–¥ –ø–æ–¥—Ç–≤–µ—Ä–∂–¥–µ–Ω–∏—è –≤–µ—Ä–Ω—ã–π.");
                            alert('–í–∞—à–∞ –ø–æ—á—Ç–∞ —É—Å–ø–µ—à–Ω–æ –ø–æ–¥—Ç–≤–µ—Ä–∂–¥–µ–Ω–∞!!!');
                            
                                const containers = document.querySelectorAll('.password-container');
                                containers.forEach(container => {  container.style.display = 'block';});
                                document.getElementById('sendVerifCode').style.display = 'none';
                                document.getElementById('ConfirmationCodeInput').style.display = 'none';
                                document.getElementById('verificationCodeInput').style.display = 'none';  
                                document.getElementById('message').style.display = 'none';  
                        } else {
                            // –û–±—Ä–∞–±–æ—Ç–∫–∞ –æ—à–∏–±–∫–∏
                            console.error("–ù–µ–≤–µ—Ä–Ω—ã–π –∫–æ–¥ –ø–æ–¥—Ç–≤–µ—Ä–∂–¥–µ–Ω–∏—è.");
                            alert('–ù–µ–≤–µ—Ä–Ω—ã–π –∫–æ–¥ –ø–æ–¥—Ç–≤–µ—Ä–∂–¥–µ–Ω–∏—è!!!');

                            const containers = document.querySelectorAll('.password-container');
                                   containers.forEach(container => { container.style.display = 'none';   });
                        }
                    }
                };

                xhr.send(JSON.stringify({ email: email, verification_code: verificationCode }));
            }
        </script>
    </body>
</html>