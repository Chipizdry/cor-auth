


<!DOCTYPE html>
<html>
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <link rel="icon" type="image/png" href="favicon.png">
    <link rel="apple-touch-icon" sizes="57x57" href="/apple-icon-57x57.png">
    <link rel="apple-touch-icon" sizes="60x60" href="/apple-icon-60x60.png">
    <link rel="apple-touch-icon" sizes="72x72" href="/apple-icon-72x72.png">
    <link rel="apple-touch-icon" sizes="76x76" href="/apple-icon-76x76.png">
    <link rel="apple-touch-icon" sizes="114x114" href="/apple-icon-114x114.png">
    <link rel="apple-touch-icon" sizes="120x120" href="/apple-icon-120x120.png">
    <link rel="apple-touch-icon" sizes="144x144" href="/apple-icon-144x144.png">
    <link rel="apple-touch-icon" sizes="152x152" href="/apple-icon-152x152.png">
    <link rel="apple-touch-icon" sizes="180x180" href="/apple-icon-180x180.png">
    <link rel="icon" type="image/png" sizes="192x192"  href="/android-icon-192x192.png">
    <link rel="icon" type="image/png" sizes="32x32" href="/favicon-32x32.png">
    <link rel="icon" type="image/png" sizes="96x96" href="/favicon-96x96.png">
    <link rel="icon" type="image/png" sizes="16x16" href="/favicon-16x16.png">
    <link rel="manifest" href="/manifest.json">
    <meta name="msapplication-TileColor" content="#ffffff">
    <meta name="msapplication-TileImage" content="/ms-icon-144x144.png">
    <meta name="theme-color" content="#ffffff">
    <link rel="icon" type="image/png" href="favicon.png">
    <link rel="stylesheet" type="text/css" href="styles.css">
    <title>–†–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏—è</title>
</head>
<body>
    <div class="container">
        <h1>–†–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏—è</h1>
        <form id="registrationForm">
            <label for="email">–≠–ª–µ–∫—Ç—Ä–æ–Ω–Ω–∞—è –ø–æ—á—Ç–∞:</label>
            <input type="email" id="email" name="email" required>
            <div id="message" class="message"></div>

            <div class="password-container hidden">
                <label for="password">–ü–∞—Ä–æ–ª—å:</label>
                <div class="input-wrapper">
                    <div id="password-message" class="error-message"></div>
                    <input type="password" id="password" name="password" placeholder="–í–≤–µ–¥–∏—Ç–µ –ø–∞—Ä–æ–ª—å" minlength="5" maxlength="21" required>
                    <span class="toggle-password" data-target="#password">üëÅÔ∏è</span>
                    
                </div>
            </div>

            <div class="password-container hidden">
                <label for="confirm-password">–ü–æ–≤—Ç–æ—Ä–∏—Ç–µ –ø–∞—Ä–æ–ª—å:</label>
                <div class="input-wrapper">
                    <input type="password" id="confirm-password" placeholder="–ü–æ–¥—Ç–≤–µ—Ä–¥–∏—Ç–µ –ø–∞—Ä–æ–ª—å" minlength="5" maxlength="21" required>
                    <span class="toggle-password" data-target="#confirm-password">üëÅÔ∏è</span>
                </div>
            </div>

            <button type="button" id="registration-button" class="hidden">–ó–∞—Ä–µ–≥–∏—Å—Ç—Ä–∏—Ä–æ–≤–∞—Ç—å—Å—è</button>
            <button type="button" id="login-button" class="hidden">–í–û–ô–¢–ò</button>
            <button type="button" id="sendVerifCode" onclick="sendVerificationCode()">–û—Ç–ø—Ä–∞–≤–∏—Ç—å –∫–æ–¥ –Ω–∞ –∏–º–µ–π–ª</button>
            <div id="confirmationMessage" class="confirmationMessage"></div>
            <div id="verificationCodeWindow" class="hidden">
                <input type="text" id="verificationCodeInput" class="hidden" placeholder="–í–≤–µ–¥–∏—Ç–µ –∫–æ–¥">
                <input type="button" id="ConfirmationCodeInput" value="–ü–æ–¥—Ç–≤–µ—Ä–¥–∏—Ç—å" class="hidden" onclick="verifyVerificationCode()">
            </div>
        </form>
        <div id="messageOk" class="messageOk"></div>
    </div>

    <script>

    const urlParams = new URLSearchParams(window.location.search);
    let redirectUrl = urlParams.get('redirectUrl');
    if (redirectUrl == null) {
    // –ü–æ —É–º–æ–ª—á–∞–Ω–∏—é
    redirectUrl = 'https://cor-identity-01s.cor-medical.ua';
        } 
    else {
        redirectUrl = redirectUrl.trim();
        }
    if (redirectUrl !== null) {
    redirectUrl = decodeURIComponent(redirectUrl);
    }

        document.addEventListener('DOMContentLoaded', function() {
            document.querySelectorAll('.toggle-password').forEach(function(element) {
                element.addEventListener('click', function() {
                    const targetInput = document.querySelector(this.dataset.target);
                    if (targetInput.type === 'password') {
                        targetInput.type = 'text';
                        this.innerText = 'üôà'; // –ò–∑–º–µ–Ω–∏—Ç–µ –∏–∫–æ–Ω–∫—É –Ω–∞ "—Å–∫—Ä—ã—Ç—å"
                    } else {
                        targetInput.type = 'password';
                        this.innerText = 'üëÅÔ∏è'; // –ò–∑–º–µ–Ω–∏—Ç–µ –∏–∫–æ–Ω–∫—É –Ω–∞ "–ø–æ–∫–∞–∑–∞—Ç—å"
                    }
                });
            });

            const confirmationMessageDiv = document.getElementById('confirmationMessage');
            const passwordInput = document.getElementById('password');
            const confirmPasswordInput = document.getElementById('confirm-password');
            const form = document.getElementById('registrationForm');
            const messageDiv = document.getElementById('messageOk');
            const registrationButton = document.getElementById('registration-button');
            const loginButton = document.getElementById('login-button');
            const passwordMessageDiv = document.getElementById('password-message');

            function checkFields() {
        const isPasswordEmpty = passwordInput.value === '';
        const isConfirmPasswordEmpty = confirmPasswordInput.value === '';
        const isPasswordValidLength = passwordInput.value.length >= 6 && passwordInput.value.length <= 20;

        if (isPasswordEmpty || isConfirmPasswordEmpty || !isPasswordValidLength) {
            registrationButton.classList.add('inactive-button');
            registrationButton.disabled = true;
            loginButton.classList.add('inactive-button');
            loginButton.disabled = true;

            if (!isPasswordValidLength) {
                passwordMessageDiv.innerText = '–ü–∞—Ä–æ–ª—å –¥–æ–ª–∂–µ–Ω —Å–æ–¥–µ—Ä–∂–∞—Ç—å –æ—Ç 6 –¥–æ 20 —Å–∏–º–≤–æ–ª–æ–≤';
                passwordMessageDiv.style.color = 'red';
            } else {
                passwordMessageDiv.innerText = '';
            }

            messageDiv.innerText = ''; // –û—á–∏—â–∞–µ–º —Å–æ–æ–±—â–µ–Ω–∏–µ –æ —Å–æ–≤–ø–∞–¥–µ–Ω–∏–∏ –ø–∞—Ä–æ–ª–µ–π
        } else {
            registrationButton.classList.remove('inactive-button');
            registrationButton.disabled = false;
            loginButton.classList.remove('inactive-button');
            loginButton.disabled = false;
            passwordMessageDiv.innerText = '';

            if (passwordInput.value !== confirmPasswordInput.value) {
                messageDiv.innerText = '–ü–∞—Ä–æ–ª–∏ –Ω–µ —Å–æ–≤–ø–∞–¥–∞—é—Ç!!!';
                messageDiv.style.color = 'red';
            } else {
                messageDiv.innerText = '–ü–∞—Ä–æ–ª–∏ —Å–æ–≤–ø–∞–¥–∞—é—Ç!';
                messageDiv.style.color = 'green';
            }
        }
        }
            // –ü—Ä–æ–≤–µ—Ä–∫–∞ –ø–æ–ª–µ–π –ø—Ä–∏ –∑–∞–≥—Ä—É–∑–∫–µ —Å—Ç—Ä–∞–Ω–∏—Ü—ã
            checkFields();



              // –ü—Ä–æ–≤–µ—Ä–∫–∞ –ø–æ–ª–µ–π –ø—Ä–∏ –≤–≤–æ–¥–µ –¥–∞–Ω–Ω—ã—Ö
          passwordInput.addEventListener('input', function() {
        checkFields();
        if (passwordInput.value.length > 0 || confirmPasswordInput.value.length > 0) {
            confirmationMessageDiv.innerText = ''; // –°–∫—Ä—ã—Ç—å —Å–æ–æ–±—â–µ–Ω–∏–µ –æ –ø–æ–¥—Ç–≤–µ—Ä–∂–¥–µ–Ω–∏–∏ –ø–æ—á—Ç—ã
               }
            });

        confirmPasswordInput.addEventListener('input', function() {
        checkFields();
        if (passwordInput.value.length > 0 || confirmPasswordInput.value.length > 0) {
            confirmationMessageDiv.innerText = ''; // –°–∫—Ä—ã—Ç—å —Å–æ–æ–±—â–µ–Ω–∏–µ –æ –ø–æ–¥—Ç–≤–µ—Ä–∂–¥–µ–Ω–∏–∏ –ø–æ—á—Ç—ã
                }
             });
            // –ü—Ä–æ–≤–µ—Ä–∫–∞ –ø–æ–ª–µ–π –ø—Ä–∏ –≤–≤–æ–¥–µ –¥–∞–Ω–Ω—ã—Ö
            passwordInput.addEventListener('input', checkFields);
            confirmPasswordInput.addEventListener('input', checkFields);

            registrationButton.addEventListener('click', () => {
                if (passwordInput.value !== confirmPasswordInput.value) {
                  //  alert('–ü–∞—Ä–æ–ª–∏ –Ω–µ —Å–æ–≤–ø–∞–¥–∞—é—Ç!');
                } else {
                 //   alert('–ü–∞—Ä–æ–ª–∏ —Å–æ–≤–ø–∞–¥–∞—é—Ç');
                    const formData = new FormData(form);
                    const formDataJson = {};

                    formData.forEach((value, key) => {
                        formDataJson[key] = value;
                    });

                    const xhr = new XMLHttpRequest();
                    xhr.open("POST", "/api/auth/signup");
                    xhr.setRequestHeader("Content-Type", "application/json");

                    xhr.onreadystatechange = function() {
                        if (xhr.readyState === XMLHttpRequest.DONE) {
                            if (xhr.status === 201) {
                                const response = JSON.parse(xhr.responseText);
                                console.log("–†–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏—è –ø—Ä–æ—à–ª–∞ —É—Å–ø–µ—à–Ω–æ.");
                                messageDiv.innerText = "–†–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏—è –ø—Ä–æ—à–ª–∞ —É—Å–ø–µ—à–Ω–æ!";
                                messageDiv.style.color = 'green';

                                registrationButton.style.display = 'none';
                                loginButton.style.display = 'block';
                            } else {
                                console.error("–ü—Ä–æ–∏–∑–æ—à–ª–∞ –æ—à–∏–±–∫–∞ –ø—Ä–∏ —Ä–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏–∏.");
                            }
                        }
                    };

                    xhr.send(JSON.stringify(formDataJson));
                }
            });

            loginButton.addEventListener('click', () => {
                const email = document.getElementById('email').value;
                const password = document.getElementById('password').value;

                const loginDataParams = new URLSearchParams();
                loginDataParams.append('username', email);
                loginDataParams.append('password', password);

                const xhr = new XMLHttpRequest();
                xhr.open("POST", "/api/auth/login");
                xhr.setRequestHeader("Content-Type", "application/x-www-form-urlencoded");

                xhr.onreadystatechange = function() {
                    if (xhr.readyState === XMLHttpRequest.DONE) {
                        if (xhr.status === 200) {
                            const response = JSON.parse(xhr.responseText);
                            console.log("–í—Ö–æ–¥ –≤—ã–ø–æ–ª–Ω–µ–Ω —É—Å–ø–µ—à–Ω–æ!");
                            messageDiv.innerText = "–í—Ö–æ–¥ –≤—ã–ø–æ–ª–Ω–µ–Ω —É—Å–ø–µ—à–Ω–æ!";
                            messageDiv.style.color = 'green';

                            setTimeout(() => {
                     
                            const refreshToken = response.refresh_token;
                            const accessToken = response.access_token;

                            urlParams.set('access_token', accessToken);
                            urlParams.set('refresh_token', refreshToken);

                            const queryString = urlParams.toString();
                            const url = `${redirectUrl}/?access_token=${accessToken}&refresh_token=${refreshToken}`;

                            window.location.href = url;
                                }, 500);
                        } else {
                            console.error("–ü—Ä–æ–∏–∑–æ—à–ª–∞ –æ—à–∏–±–∫–∞ –ø—Ä–∏ –≤—Ö–æ–¥–µ.");
                            messageDiv.innerText = "–û—à–∏–±–∫–∞ –≤—Ö–æ–¥–∞.";
                            messageDiv.style.color = 'red';
                        }
                    }
                };

                xhr.send(loginDataParams.toString());
            });
        });

        function sendVerificationCode() {
            var form = document.getElementById("registrationForm");
            var emailInput = form.elements.email;
            var messageDiv = document.getElementById("message");
            var confirmationMessageDiv = document.getElementById("confirmationMessage");
            var email = emailInput.value;
            var sendCodeButton = document.getElementById('sendVerifCode');

            var xhr = new XMLHttpRequest();
            xhr.open("POST", "/api/auth/send_verification_code");
            xhr.setRequestHeader("Content-Type", "application/json");

            xhr.onreadystatechange = function() {
                if (xhr.readyState === XMLHttpRequest.DONE) {
                    if (xhr.status === 200) {
                      //  alert('–ö–æ–¥ –ø–æ–¥—Ç–≤–µ—Ä–∂–¥–µ–Ω–∏—è –æ—Ç–ø—Ä–∞–≤–ª–µ–Ω –Ω–∞ –í–∞—à—É –ø–æ—á—Ç—É!');
                        console.log("–ö–æ–¥ –ø–æ–¥—Ç–≤–µ—Ä–∂–¥–µ–Ω–∏—è –æ—Ç–ø—Ä–∞–≤–ª–µ–Ω –Ω–∞ –≤–∞—à—É —ç–ª–µ–∫—Ç—Ä–æ–Ω–Ω—É—é –ø–æ—á—Ç—É.");
                        confirmationMessageDiv.innerText = "–ö–æ–¥ –ø–æ–¥—Ç–≤–µ—Ä–∂–¥–µ–Ω–∏—è –≤—ã—Å–ª–∞–Ω –í–∞–º –Ω–∞ –∏–º–µ–π–ª!";
                        confirmationMessageDiv.style.color = 'green';

                        showVerificationCodeInput();
                        messageDiv.style.display = 'none';

                        document.getElementById('ConfirmationCodeInput').style.display = 'block';
                        document.getElementById('verificationCodeInput').style.display = 'block';

                             // –ë–ª–æ–∫–∏—Ä—É–µ–º –∫–Ω–æ–ø–∫—É –∏ —É—Å—Ç–∞–Ω–∞–≤–ª–∏–≤–∞–µ–º –æ–±—Ä–∞—Ç–Ω—ã–π –æ—Ç—Å—á–µ—Ç
                //var sendCodeButton = document.getElementById('sendVerifCode');


                sendCodeButton.disabled = true;
                        sendCodeButton.classList.add('inactive-button');
                        
                        var countdown = 30;
                        sendCodeButton.textContent = `–û—Ç–ø—Ä–∞–≤–∏—Ç—å –µ—â—ë —á–µ—Ä–µ–∑ ${countdown}—Å`;

                        var interval = setInterval(function() {
                            countdown--;
                            sendCodeButton.textContent = `–û—Ç–ø—Ä–∞–≤–∏—Ç—å –µ—â—ë —á–µ—Ä–µ–∑ ${countdown}—Å`;
                            if (countdown <= 0) {
                                clearInterval(interval);
                                sendCodeButton.disabled = false;
                                sendCodeButton.classList.remove('inactive-button');
                                sendCodeButton.textContent = '–û—Ç–ø—Ä–∞–≤–∏—Ç—å –∫–æ–¥ –Ω–∞ –∏–º–µ–π–ª';
                                //confirmationMessageDiv.style.display = 'none';
                            }
                        }, 1000);

                    } else {
                        var error = JSON.parse(xhr.responseText);
                        console.error("–ü—Ä–æ–∏–∑–æ—à–ª–∞ –æ—à–∏–±–∫–∞ –ø—Ä–∏ –æ—Ç–ø—Ä–∞–≤–∫–µ –∫–æ–¥–∞ –ø–æ–¥—Ç–≤–µ—Ä–∂–¥–µ–Ω–∏—è –Ω–∞ –ø–æ—á—Ç—É.");
                        messageDiv.innerText = error.detail || "–ü—Ä–æ–∏–∑–æ—à–ª–∞ –æ—à–∏–±–∫–∞ –ø—Ä–∏ –æ—Ç–ø—Ä–∞–≤–∫–µ –∫–æ–¥–∞ –ø–æ–¥—Ç–≤–µ—Ä–∂–¥–µ–Ω–∏—è –Ω–∞ –ø–æ—á—Ç—É.";
                        messageDiv.style.color = 'red';
                    }
                }
            };

            xhr.send(JSON.stringify({ email: email }));
        }

        function showVerificationCodeInput() {
            var verificationCodeWindow = document.getElementById("verificationCodeWindow");
            verificationCodeWindow.style.display = "block";
        }

        function verifyVerificationCode() {
            var verificationCodeInput = document.getElementById("verificationCodeInput");
            var emailInput = document.getElementById("email");
            var confirmationMessageDiv = document.getElementById("confirmationMessage");
            var email = emailInput.value;
            var verificationCode = verificationCodeInput.value;

            var xhr = new XMLHttpRequest();
            xhr.open("POST", "/api/auth/confirm_email");
            xhr.setRequestHeader("Content-Type", "application/json");

            xhr.onreadystatechange = function() {
                if (xhr.readyState === XMLHttpRequest.DONE) {
                    if (xhr.status === 200) {
                        confirmationMessageDiv.innerText = "–í–∞—à–∞ –ø–æ—á—Ç–∞ —É—Å–ø–µ—à–Ω–æ –ø–æ–¥—Ç–≤–µ—Ä–∂–¥–µ–Ω–∞!";
                        confirmationMessageDiv.style.color = 'green';
                        confirmationMessageDiv.style.display = 'block'; // confirmationMessageDiv.style.display = 'none';
                      
                        console.log("–ö–æ–¥ –ø–æ–¥—Ç–≤–µ—Ä–∂–¥–µ–Ω–∏—è –≤–µ—Ä–Ω—ã–π.");
                      
                        const containers = document.querySelectorAll('.password-container');
                        containers.forEach(container => { container.style.display = 'block'; });
                        document.getElementById('sendVerifCode').style.display = 'none';
                        document.getElementById('registration-button').style.display = 'block';
                        document.getElementById('ConfirmationCodeInput').style.display = 'none';
                        document.getElementById('verificationCodeInput').style.display = 'none';
                        document.getElementById('message').style.display = 'none';
                    } else {
                        console.error("–ù–µ–≤–µ—Ä–Ω—ã–π –∫–æ–¥ –ø–æ–¥—Ç–≤–µ—Ä–∂–¥–µ–Ω–∏—è.");
                       // alert('–ù–µ–≤–µ—Ä–Ω—ã–π –∫–æ–¥ –ø–æ–¥—Ç–≤–µ—Ä–∂–¥–µ–Ω–∏—è!!!');

                        confirmationMessageDiv.innerText = "–ù–ï–í–ï–†–ù–´–ô –ö–û–î –ü–û–î–¢–í–ï–†–ñ–î–ï–ù–ò–Ø!!!";
                        confirmationMessageDiv.style.color = 'red';
                        confirmationMessageDiv.style.display = 'block';
                        const containers = document.querySelectorAll('.password-container');
                        containers.forEach(container => { container.style.display = 'none'; });
                        setTimeout(function() {
                            verificationCodeInput.value = "";
                            confirmationMessageDiv.innerText = " ";
                            
                                                            }, 3000);
                    }
                }
            };

            xhr.send(JSON.stringify({ email: email, verification_code: verificationCode }));
        }
    </script>
</body>
</html>



<!--

<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <link rel="icon" type="image/png" href="favicon.png">
    <link rel="apple-touch-icon" sizes="57x57" href="/apple-icon-57x57.png">
    <link rel="apple-touch-icon" sizes="60x60" href="/apple-icon-60x60.png">
    <link rel="apple-touch-icon" sizes="72x72" href="/apple-icon-72x72.png">
    <link rel="apple-touch-icon" sizes="76x76" href="/apple-icon-76x76.png">
    <link rel="apple-touch-icon" sizes="114x114" href="/apple-icon-114x114.png">
    <link rel="apple-touch-icon" sizes="120x120" href="/apple-icon-120x120.png">
    <link rel="apple-touch-icon" sizes="144x144" href="/apple-icon-144x144.png">
    <link rel="apple-touch-icon" sizes="152x152" href="/apple-icon-152x152.png">
    <link rel="apple-touch-icon" sizes="180x180" href="/apple-icon-180x180.png">
    <link rel="icon" type="image/png" sizes="192x192" href="/android-icon-192x192.png">
    <link rel="icon" type="image/png" sizes="32x32" href="/favicon-32x32.png">
    <link rel="icon" type="image/png" sizes="96x96" href="/favicon-96x96.png">
    <link rel="icon" type="image/png" sizes="16x16" href="/favicon-16x16.png">
    <link rel="manifest" href="/manifest.json">
    <meta name="msapplication-TileColor" content="#ffffff">
    <meta name="msapplication-TileImage" content="/ms-icon-144x144.png">
    <meta name="theme-color" content="#ffffff">
    <link rel="stylesheet" type="text/css" href="styles.css">
    <title data-translate="registration">–†–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏—è</title>
</head>
<body>
    <div class="container">
        <h1 data-translate="registration">–†–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏—è</h1>
        <form id="registrationForm">
            <label for="email" data-translate="email-label">–≠–ª–µ–∫—Ç—Ä–æ–Ω–Ω–∞—è –ø–æ—á—Ç–∞:</label>
            <input type="email" id="email" name="email" required>
            <div id="message" class="message"></div>

            <div class="password-container hidden">
                <label for="password" data-translate="password-label">–ü–∞—Ä–æ–ª—å:</label>
                <div class="input-wrapper">
                    <div id="password-message" class="error-message"></div>
                    <input type="password" id="password" name="password" placeholder="–í–≤–µ–¥–∏—Ç–µ –ø–∞—Ä–æ–ª—å" minlength="5" maxlength="21" required>
                    <span class="toggle-password" data-target="#password">üëÅÔ∏è</span>
                </div>
            </div>

            <div class="password-container hidden">
                <label for="confirm-password" data-translate="confirm-password-label">–ü–æ–≤—Ç–æ—Ä–∏—Ç–µ –ø–∞—Ä–æ–ª—å:</label>
                <div class="input-wrapper">
                    <input type="password" id="confirm-password" placeholder="–ü–æ–¥—Ç–≤–µ—Ä–¥–∏—Ç–µ –ø–∞—Ä–æ–ª—å" minlength="5" maxlength="21" required>
                    <span class="toggle-password" data-target="#confirm-password">üëÅÔ∏è</span>
                </div>
            </div>

            <button type="button" id="registration-button" class="hidden" data-translate="registration-button">–ó–∞—Ä–µ–≥–∏—Å—Ç—Ä–∏—Ä–æ–≤–∞—Ç—å—Å—è</button>
            <button type="button" id="login-button" class="hidden" data-translate="login-button">–í–û–ô–¢–ò</button>
            <button type="button" id="sendVerifCode" onclick="sendVerificationCode()" data-translate="send-code-again">–û—Ç–ø—Ä–∞–≤–∏—Ç—å –∫–æ–¥ –Ω–∞ –∏–º–µ–π–ª</button>
            <div id="confirmationMessage" class="confirmationMessage"></div>
            <div id="verificationCodeWindow" class="hidden">
                <input type="text" id="verificationCodeInput" class="hidden" placeholder="–í–≤–µ–¥–∏—Ç–µ –∫–æ–¥" data-translate="confirmation-code-placeholder">
                <input type="button" id="ConfirmationCodeInput" value="–ü–æ–¥—Ç–≤–µ—Ä–¥–∏—Ç—å" class="hidden" onclick="verifyVerificationCode()" data-translate="confirmation-code-input">
            </div>
        </form>
        <div id="messageOk" class="messageOk"></div>
    </div>

    <script>
        const translations = {
            en: {
                registration: "Registration",
                "email-label": "Email:",
                "password-label": "Password:",
                "confirm-password-label": "Confirm Password:",
                "registration-button": "Register",
                "login-button": "Login",
                "send-code-again": "Send code again",
                "confirmation-code-placeholder": "Enter code",
                "confirmation-code-input": "Confirm",
                "password-requirements": "Password must be between 6 and 20 characters.",
                "passwords-not-match": "Passwords do not match.",
                "passwords-match": "Passwords match.",
                "registration-success": "Registration successful!",
                "login-success": "Login successful!",
                "login-error": "Login failed. Please check your credentials.",
                "code-sent": "Verification code sent to your email.",
                "code-sent-error": "Error sending verification code. Please try again.",
                "email-confirmed": "Email confirmed. Please set your password.",
                "invalid-code": "Invalid verification code. Please try again."
            },
            ru: {
                registration: "–†–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏—è",
                "email-label": "–≠–ª–µ–∫—Ç—Ä–æ–Ω–Ω–∞—è –ø–æ—á—Ç–∞:",
                "password-label": "–ü–∞—Ä–æ–ª—å:",
                "confirm-password-label": "–ü–æ–≤—Ç–æ—Ä–∏—Ç–µ –ø–∞—Ä–æ–ª—å:",
                "registration-button": "–ó–∞—Ä–µ–≥–∏—Å—Ç—Ä–∏—Ä–æ–≤–∞—Ç—å—Å—è",
                "login-button": "–í–û–ô–¢–ò",
                "send-code-again": "–û—Ç–ø—Ä–∞–≤–∏—Ç—å –∫–æ–¥ –Ω–∞ –∏–º–µ–π–ª",
                "confirmation-code-placeholder": "–í–≤–µ–¥–∏—Ç–µ –∫–æ–¥",
                "confirmation-code-input": "–ü–æ–¥—Ç–≤–µ—Ä–¥–∏—Ç—å",
                "password-requirements": "–ü–∞—Ä–æ–ª—å –¥–æ–ª–∂–µ–Ω —Å–æ–¥–µ—Ä–∂–∞—Ç—å –æ—Ç 6 –¥–æ 20 —Å–∏–º–≤–æ–ª–æ–≤.",
                "passwords-not-match": "–ü–∞—Ä–æ–ª–∏ –Ω–µ —Å–æ–≤–ø–∞–¥–∞—é—Ç.",
                "passwords-match": "–ü–∞—Ä–æ–ª–∏ —Å–æ–≤–ø–∞–¥–∞—é—Ç.",
                "registration-success": "–†–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏—è –ø—Ä–æ—à–ª–∞ —É—Å–ø–µ—à–Ω–æ!",
                "login-success": "–í—Ö–æ–¥ –≤—ã–ø–æ–ª–Ω–µ–Ω —É—Å–ø–µ—à–Ω–æ!",
                "login-error": "–û—à–∏–±–∫–∞ –≤—Ö–æ–¥–∞. –ü–æ–∂–∞–ª—É–π—Å—Ç–∞, –ø—Ä–æ–≤–µ—Ä—å—Ç–µ —Å–≤–æ–∏ –¥–∞–Ω–Ω—ã–µ.",
                "code-sent": "–ö–æ–¥ –ø–æ–¥—Ç–≤–µ—Ä–∂–¥–µ–Ω–∏—è –æ—Ç–ø—Ä–∞–≤–ª–µ–Ω –Ω–∞ –≤–∞—à—É —ç–ª–µ–∫—Ç—Ä–æ–Ω–Ω—É—é –ø–æ—á—Ç—É.",
                "code-sent-error": "–û—à–∏–±–∫–∞ –æ—Ç–ø—Ä–∞–≤–∫–∏ –∫–æ–¥–∞ –ø–æ–¥—Ç–≤–µ—Ä–∂–¥–µ–Ω–∏—è. –ü–æ–∂–∞–ª—É–π—Å—Ç–∞, –ø–æ–ø—Ä–æ–±—É–π—Ç–µ —Å–Ω–æ–≤–∞.",
                "email-confirmed": "–≠–ª–µ–∫—Ç—Ä–æ–Ω–Ω–∞—è –ø–æ—á—Ç–∞ –ø–æ–¥—Ç–≤–µ—Ä–∂–¥–µ–Ω–∞. –ü–æ–∂–∞–ª—É–π—Å—Ç–∞, —É—Å—Ç–∞–Ω–æ–≤–∏—Ç–µ –ø–∞—Ä–æ–ª—å.",
                "invalid-code": "–ù–µ–≤–µ—Ä–Ω—ã–π –∫–æ–¥ –ø–æ–¥—Ç–≤–µ—Ä–∂–¥–µ–Ω–∏—è. –ü–æ–∂–∞–ª—É–π—Å—Ç–∞, –ø–æ–ø—Ä–æ–±—É–π—Ç–µ —Å–Ω–æ–≤–∞."
            },
            zh: {
                registration: "Ê≥®ÂÜå",
                "email-label": "ÁîµÂ≠êÈÇÆ‰ª∂:",
                "password-label": "ÂØÜÁ†Å:",
                "confirm-password-label": "Á°ÆËÆ§ÂØÜÁ†Å:",
                "registration-button": "Ê≥®ÂÜå",
                "login-button": "ÁôªÂΩï",
                "send-code-again": "ÂÜçÊ¨°ÂèëÈÄÅÈ™åËØÅÁ†Å",
                "confirmation-code-placeholder": "ËæìÂÖ•È™åËØÅÁ†Å",
                "confirmation-code-input": "Á°ÆËÆ§",
                "password-requirements": "ÂØÜÁ†ÅÈïøÂ∫¶ÂøÖÈ°ªÂú®6Âà∞20‰∏™Â≠óÁ¨¶‰πãÈó¥„ÄÇ",
                "passwords-not-match": "ÂØÜÁ†Å‰∏çÂåπÈÖç„ÄÇ",
                "passwords-match": "ÂØÜÁ†ÅÂåπÈÖç„ÄÇ",
                "registration-success": "Ê≥®ÂÜåÊàêÂäüÔºÅ",
                "login-success": "ÁôªÂΩïÊàêÂäüÔºÅ",
                "login-error": "ÁôªÂΩïÂ§±Ë¥•„ÄÇËØ∑Ê£ÄÊü•ÊÇ®ÁöÑÂá≠ÊçÆ„ÄÇ",
                "code-sent": "È™åËØÅÁ†ÅÂ∑≤ÂèëÈÄÅÂà∞ÊÇ®ÁöÑÁîµÂ≠êÈÇÆ‰ª∂„ÄÇ",
                "code-sent-error": "ÂèëÈÄÅÈ™åËØÅÁ†ÅÊó∂Âá∫Èîô„ÄÇËØ∑ÂÜçËØï‰∏ÄÊ¨°„ÄÇ",
                "email-confirmed": "ÁîµÂ≠êÈÇÆ‰ª∂Â∑≤Á°ÆËÆ§„ÄÇËØ∑ËÆæÁΩÆÊÇ®ÁöÑÂØÜÁ†Å„ÄÇ",
                "invalid-code": "È™åËØÅÁ†ÅÊó†Êïà„ÄÇËØ∑ÂÜçËØï‰∏ÄÊ¨°„ÄÇ"
            },
            uk: {
                registration: "–†–µ—î—Å—Ç—Ä–∞—Ü—ñ—è",
                "email-label": "–ï–ª–µ–∫—Ç—Ä–æ–Ω–Ω–∞ –ø–æ—à—Ç–∞:",
                "password-label": "–ü–∞—Ä–æ–ª—å:",
                "confirm-password-label": "–ü—ñ–¥—Ç–≤–µ—Ä–¥—ñ—Ç—å –ø–∞—Ä–æ–ª—å:",
                "registration-button": "–ó–∞—Ä–µ—î—Å—Ç—Ä—É–≤–∞—Ç–∏—Å—è",
                "login-button": "–£–í–Ü–ô–¢–ò",
                "send-code-again": "–í—ñ–¥–ø—Ä–∞–≤–∏—Ç–∏ –∫–æ–¥ –Ω–∞ –ø–æ—à—Ç—É",
                "confirmation-code-placeholder": "–í–≤–µ–¥—ñ—Ç—å –∫–æ–¥",
                "confirmation-code-input": "–ü—ñ–¥—Ç–≤–µ—Ä–¥–∏—Ç–∏",
                "password-requirements": "–ü–∞—Ä–æ–ª—å –ø–æ–≤–∏–Ω–µ–Ω –º—ñ—Å—Ç–∏—Ç–∏ –≤—ñ–¥ 6 –¥–æ 20 —Å–∏–º–≤–æ–ª—ñ–≤.",
                "passwords-not-match": "–ü–∞—Ä–æ–ª—ñ –Ω–µ –∑–±—ñ–≥–∞—é—Ç—å—Å—è.",
                "passwords-match": "–ü–∞—Ä–æ–ª—ñ –∑–±—ñ–≥–∞—é—Ç—å—Å—è.",
                "registration-success": "–†–µ—î—Å—Ç—Ä–∞—Ü—ñ—è —É—Å–ø—ñ—à–Ω–∞!",
                "login-success": "–í—Ö—ñ–¥ —É—Å–ø—ñ—à–Ω–∏–π!",
                "login-error": "–ü–æ–º–∏–ª–∫–∞ –≤—Ö–æ–¥—É. –ë—É–¥—å –ª–∞—Å–∫–∞, –ø–µ—Ä–µ–≤—ñ—Ä—Ç–µ —Å–≤–æ—ó –¥–∞–Ω—ñ.",
                "code-sent": "–ö–æ–¥ –ø—ñ–¥—Ç–≤–µ—Ä–¥–∂–µ–Ω–Ω—è –≤—ñ–¥–ø—Ä–∞–≤–ª–µ–Ω–æ –Ω–∞ –≤–∞—à—É –µ–ª–µ–∫—Ç—Ä–æ–Ω–Ω—É –ø–æ—à—Ç—É.",
                "code-sent-error": "–ü–æ–º–∏–ª–∫–∞ –≤—ñ–¥–ø—Ä–∞–≤–∫–∏ –∫–æ–¥—É –ø—ñ–¥—Ç–≤–µ—Ä–¥–∂–µ–Ω–Ω—è. –ë—É–¥—å –ª–∞—Å–∫–∞, —Å–ø—Ä–æ–±—É–π—Ç–µ —â–µ —Ä–∞–∑.",
                "email-confirmed": "–ï–ª–µ–∫—Ç—Ä–æ–Ω–Ω–∞ –ø–æ—à—Ç–∞ –ø—ñ–¥—Ç–≤–µ—Ä–¥–∂–µ–Ω–∞. –ë—É–¥—å –ª–∞—Å–∫–∞, –≤—Å—Ç–∞–Ω–æ–≤—ñ—Ç—å –ø–∞—Ä–æ–ª—å.",
                "invalid-code": "–ù–µ–≤—ñ—Ä–Ω–∏–π –∫–æ–¥ –ø—ñ–¥—Ç–≤–µ—Ä–¥–∂–µ–Ω–Ω—è. –ë—É–¥—å –ª–∞—Å–∫–∞, —Å–ø—Ä–æ–±—É–π—Ç–µ —â–µ —Ä–∞–∑."
            }
        };

        document.addEventListener('DOMContentLoaded', function() {
            const defaultLang = localStorage.getItem('selectedLanguage') || 'ru';

            function updateTexts() {
                document.querySelectorAll('[data-translate]').forEach(el => {
                    const key = el.getAttribute('data-translate');
                    if (translations[defaultLang][key]) {
                        el.innerText = translations[defaultLang][key];
                    }
                });
            }

            updateTexts();

            const passwordInput = document.getElementById('password');
            const confirmPasswordInput = document.getElementById('confirm-password');
            const messageDiv = document.getElementById('message');
            const confirmationMessageDiv = document.getElementById('confirmationMessage');
            const form = document.getElementById('registrationForm');
            const registrationButton = document.getElementById('registration-button');
            const loginButton = document.getElementById('login-button');

            const redirectUrl = '/dashboard';
            const urlParams = new URLSearchParams(window.location.search);

            document.querySelectorAll('.toggle-password').forEach(toggle => {
                toggle.addEventListener('click', function() {
                    const target = document.querySelector(this.getAttribute('data-target'));
                    const type = target.getAttribute('type') === 'password' ? 'text' : 'password';
                    target.setAttribute('type', type);
                    this.innerText = type === 'password' ? 'üëÅÔ∏è' : 'üôà';
                });
            });

            function checkFields() {
                if (passwordInput.value.length < 6 || passwordInput.value.length > 20) {
                    messageDiv.innerText = translations[defaultLang]["password-requirements"];
                    messageDiv.style.color = 'red';
                } else {
                    messageDiv.innerText = '';

                    if (passwordInput.value !== confirmPasswordInput.value) {
                        messageDiv.innerText = translations[defaultLang]["passwords-not-match"];
                        messageDiv.style.color = 'red';
                    } else {
                        messageDiv.innerText = translations[defaultLang]["passwords-match"];
                        messageDiv.style.color = 'green';
                    }
                }
            }

            checkFields();

            passwordInput.addEventListener('input', function() {
                checkFields();
                if (passwordInput.value.length > 0 || confirmPasswordInput.value.length > 0) {
                    confirmationMessageDiv.innerText = '';
                }
            });

            confirmPasswordInput.addEventListener('input', function() {
                checkFields();
                if (passwordInput.value.length > 0 || confirmPasswordInput.value.length > 0) {
                    confirmationMessageDiv.innerText = '';
                }
            });

            passwordInput.addEventListener('input', checkFields);
            confirmPasswordInput.addEventListener('input', checkFields);

            registrationButton.addEventListener('click', () => {
                if (passwordInput.value !== confirmPasswordInput.value) {
                } else {
                    const formData = new FormData(form);
                    const formDataJson = {};

                    formData.forEach((value, key) => {
                        formDataJson[key] = value;
                    });

                    const xhr = new XMLHttpRequest();
                    xhr.open("POST", "/api/auth/signup");
                    xhr.setRequestHeader("Content-Type", "application/json");

                    xhr.onreadystatechange = function() {
                        if (xhr.readyState === XMLHttpRequest.DONE) {
                            if (xhr.status === 201) {
                                const response = JSON.parse(xhr.responseText);
                                console.log("–†–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏—è –ø—Ä–æ—à–ª–∞ —É—Å–ø–µ—à–Ω–æ.");
                                messageDiv.innerText = translations[defaultLang]["registration-success"];
                                messageDiv.style.color = 'green';

                                registrationButton.style.display = 'none';
                                loginButton.style.display = 'block';
                            } else {
                                console.error("–ü—Ä–æ–∏–∑–æ—à–ª–∞ –æ—à–∏–±–∫–∞ –ø—Ä–∏ —Ä–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏–∏.");
                            }
                        }
                    };

                    xhr.send(JSON.stringify(formDataJson));
                }
            });

            loginButton.addEventListener('click', () => {
                const email = document.getElementById('email').value;
                const password = document.getElementById('password').value;

                const loginDataParams = new URLSearchParams();
                loginDataParams.append('username', email);
                loginDataParams.append('password', password);

                const xhr = new XMLHttpRequest();
                xhr.open("POST", "/api/auth/login");
                xhr.setRequestHeader("Content-Type", "application/x-www-form-urlencoded");

                xhr.onreadystatechange = function() {
                    if (xhr.readyState === XMLHttpRequest.DONE) {
                        if (xhr.status === 200) {
                            const response = JSON.parse(xhr.responseText);
                            console.log("–í—Ö–æ–¥ –≤—ã–ø–æ–ª–Ω–µ–Ω —É—Å–ø–µ—à–Ω–æ!");
                            messageDiv.innerText = translations[defaultLang]["login-success"];
                            messageDiv.style.color = 'green';

                            setTimeout(() => {
                                const refreshToken = response.refresh_token;
                                const accessToken = response.access_token;

                                urlParams.set('access_token', accessToken);
                                urlParams.set('refresh_token', refreshToken);

                                const queryString = urlParams.toString();
                                const url = `${redirectUrl}/?access_token=${accessToken}&refresh_token=${refreshToken}`;

                                window.location.href = url;
                            }, 500);
                        } else {
                            console.error("–ü—Ä–æ–∏–∑–æ—à–ª–∞ –æ—à–∏–±–∫–∞ –ø—Ä–∏ –≤—Ö–æ–¥–µ.");
                            messageDiv.innerText = translations[defaultLang]["login-error"];
                            messageDiv.style.color = 'red';
                        }
                    }
                };

                xhr.send(loginDataParams.toString());
            });
        });

        function sendVerificationCode() {
            var form = document.getElementById("registrationForm");
            var emailInput = form.elements.email;
            var messageDiv = document.getElementById("message");
            var confirmationMessageDiv = document.getElementById("confirmationMessage");
            var email = emailInput.value;
            var sendCodeButton = document.getElementById('sendVerifCode');

            var xhr = new XMLHttpRequest();
            xhr.open("POST", "/api/auth/send_verification_code");
            xhr.setRequestHeader("Content-Type", "application/json");

            xhr.onreadystatechange = function() {
                if (xhr.readyState === XMLHttpRequest.DONE) {
                    if (xhr.status === 200) {
                        console.log("–ö–æ–¥ –ø–æ–¥—Ç–≤–µ—Ä–∂–¥–µ–Ω–∏—è –æ—Ç–ø—Ä–∞–≤–ª–µ–Ω –Ω–∞ –≤–∞—à—É —ç–ª–µ–∫—Ç—Ä–æ–Ω–Ω—É—é –ø–æ—á—Ç—É.");
                        confirmationMessageDiv.innerText = translations[defaultLang]["code-sent"];
                        confirmationMessageDiv.style.color = 'green';

                        showVerificationCodeInput();
                        messageDiv.style.display = 'none';

                        document.getElementById('ConfirmationCodeInput').style.display = 'block';
                        document.getElementById('verificationCodeInput').style.display = 'block';

                        sendCodeButton.disabled = true;
                        sendCodeButton.classList.add('inactive-button');
                        
                        var countdown = 30;
                        sendCodeButton.textContent = translations[defaultLang]["send-code-again"] + ` (${countdown}s)`;

                        var interval = setInterval(function() {
                            countdown--;
                            sendCodeButton.textContent = translations[defaultLang]["send-code-again"] + ` (${countdown}s)`;
                            if (countdown <= 0) {
                                clearInterval(interval);
                                sendCodeButton.disabled = false;
                                sendCodeButton.classList.remove('inactive-button');
                                sendCodeButton.textContent = translations[defaultLang]["send-code-again"];
                            }
                        }, 1000);

                    } else {
                        var error = JSON.parse(xhr.responseText);
                        console.error("–ü—Ä–æ–∏–∑–æ—à–ª–∞ –æ—à–∏–±–∫–∞ –ø—Ä–∏ –æ—Ç–ø—Ä–∞–≤–∫–µ –∫–æ–¥–∞ –ø–æ–¥—Ç–≤–µ—Ä–∂–¥–µ–Ω–∏—è –Ω–∞ –ø–æ—á—Ç—É.");
                        messageDiv.innerText = error.detail || translations[defaultLang]["code-sent-error"];
                        messageDiv.style.color = 'red';
                    }
                }
            };

            xhr.send(JSON.stringify({ email: email }));
        }

        function showVerificationCodeInput() {
            var verificationCodeWindow = document.getElementById("verificationCodeWindow");
            verificationCodeWindow.style.display = "block";
        }

        function verifyVerificationCode() {
            var verificationCodeInput = document.getElementById("verificationCodeInput");
            var emailInput = document.getElementById("email");
            var confirmationMessageDiv = document.getElementById("confirmationMessage");
            var email = emailInput.value;
            var verificationCode = verificationCodeInput.value;

            var xhr = new XMLHttpRequest();
            xhr.open("POST", "/api/auth/confirm_email");
            xhr.setRequestHeader("Content-Type", "application/json");

            xhr.onreadystatechange = function() {
                if (xhr.readyState === XMLHttpRequest.DONE) {
                    if (xhr.status === 200) {
                        confirmationMessageDiv.innerText = translations[defaultLang]["email-confirmed"];
                        confirmationMessageDiv.style.color = 'green';
                        confirmationMessageDiv.style.display = 'block';
                      
                        console.log("–ö–æ–¥ –ø–æ–¥—Ç–≤–µ—Ä–∂–¥–µ–Ω–∏—è –≤–µ—Ä–Ω—ã–π.");
                      
                        const containers = document.querySelectorAll('.password-container');
                        containers.forEach(container => { container.style.display = 'block'; });
                        document.getElementById('sendVerifCode').style.display = 'none';
                        document.getElementById('registration-button').style.display = 'block';
                        document.getElementById('ConfirmationCodeInput').style.display = 'none';
                        document.getElementById('verificationCodeInput').style.display = 'none';
                        document.getElementById('message').style.display = 'none';
                    } else {
                        console.error("–ù–µ–≤–µ—Ä–Ω—ã–π –∫–æ–¥ –ø–æ–¥—Ç–≤–µ—Ä–∂–¥–µ–Ω–∏—è.");

                        confirmationMessageDiv.innerText = translations[defaultLang]["invalid-code"];
                        confirmationMessageDiv.style.color = 'red';
                        confirmationMessageDiv.style.display = 'block';
                        const containers = document.querySelectorAll('.password-container');
                        containers.forEach(container => { container.style.display = 'none'; });
                        document.getElementById('registration-button').style.display = 'none';
                    }
                }
            };

            xhr.send(JSON.stringify({ email: email, code: verificationCode }));
        }
    </script>
</body>
</html>
-->